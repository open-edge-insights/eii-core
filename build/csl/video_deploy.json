{
    "Name": "EISVIDEO",
    "Version": "0.2",
    "Description": "Edge Insights Software Video Usecase Deployment",
    "Type": "persistent",
    "DataStore": {
        "DataBucket": "EIS"
    },
    "Modules": [
	{
            "Name": "EtcdUI",
            "Description": "EtcdUI module manifest",
            "SchemaVersion": "0.2",
            "ManifestFile": "${idx:etcdui:$EIS_VERSION}",
            "RunAsUser": "$EIS_UID",
            "RunAsGroup": "$EIS_UID",
            "Resources": {
                "CPU": 100,
                "MemoryMB": 100
            },
            "ExecutionEnv": {
                "AppName": "EtcdUI",
                "ETCD_ENDPOINT": "${datastore.endpoint}",
                "CONFIGMGR_CACERT": "${databucket.cacert}",
                "CONFIGMGR_CERT": "${databucket.cert}",
                "CONFIGMGR_KEY": "${databucket.key}",
                "ETCD_PREFIX": "$ETCD_PREFIX",
                "ETCD_USER": "eisuser",
                "ETCD_PASSWORD": "Eis@123",
                "DEV_MODE": "$DEV_MODE",
                "PROFILING_MODE": "false",
                "NGINX_PORT": 7071
            },
            "Endpoints": [
                {
                    "Name": "etcdout",
                    "Endtype": "server",
                    "Protocol": "TCP",
                    "Port": "7070",
                    "DataType": "messages",
                    "Link": "etcduiout"
                }
            ]
        },
        {
            "Name": "VideoIngestion",
            "Description": "Video_Ingestion module manifest",
            "SchemaVersion": "0.2",
            "ManifestFile": "${idx:videoingestion:$EIS_VERSION}",
            "Resources": {
                "CPU": 4000,
                "MemoryMB": 2000
            },
            "Networks": [
                "cslhostnetworkinterface"
            ],
            "ExecutionEnv": {
                "AppName": "VideoIngestion",
                "ETCD_ENDPOINT": "${datastore.endpoint}",
                "CONFIGMGR_CACERT": "${databucket.cacert}",
                "CONFIGMGR_CERT": "${databucket.cert}",
                "CONFIGMGR_KEY": "${databucket.key}",
                "ETCD_PREFIX": "$ETCD_PREFIX",
                "DEV_MODE": "$DEV_MODE",
                "Clients": "VideoAnalytics,WebVisualizer",
                "PROFILING_MODE": "false",
                "ZMQ_RECV_HWM": "1000",
                "PubTopics": "camera1_stream",
                "camera1_stream_cfg": "zmq_tcp,0.0.0.0:${ep.output-vi.localport}",
                "Server": "zmq_tcp,0.0.0.0:${ep.output-vi-sw-tr.localport}"
            },
            "Endpoints": [
                {
                    "Name": "output-vi-sw-tr",
                    "Endtype": "server",
                    "DataType": "messages",
                    "Link": "vi-sw-tr"
                },
                {
                    "Name": "output-vi",
                    "Endtype": "server",
                    "DataType": "messages",
                    "Link": "vi-va-link"
                }
            ]
        },
        {
            "Name": "VideoAnalytics",
            "Description": "VideoAnalytics module manifest",
            "SchemaVersion": "0.2",
            "ManifestFile": "${idx:videoanalytics:$EIS_VERSION}",
            "Resources": {
                "CPU": 100,
                "MemoryMB": 100
            },
            "ExecutionEnv": {
                "AppName": "VideoAnalytics",
                "ETCD_ENDPOINT": "${datastore.endpoint}",
                "CONFIGMGR_CACERT": "${databucket.cacert}",
                "CONFIGMGR_CERT": "${databucket.cert}",
                "CONFIGMGR_KEY": "${databucket.key}",
                "DEV_MODE": "$DEV_MODE",
                "ETCD_PREFIX": "$ETCD_PREFIX",
                "PROFILING_MODE": "false",
                "ZMQ_RECV_HWM": "1000",
                "Clients": "WebVisualizer,InfluxDBConnector,ImageStore",
                "SubTopics": "VideoIngestion/camera1_stream",
                "camera1_stream_cfg": "zmq_tcp,${ep.input-va.remoteaddress}:${ep.input-va.remoteport}",
                "PubTopics": "camera1_stream_results",
                "camera1_stream_results_cfg": "zmq_tcp,0.0.0.0:${ep.output-va.localport}"
            },
            "Endpoints": [
                {
                    "Name": "output-va",
                    "Endtype": "server",
                    "Protocol": "TCP",
                    "DataType": "messages",
                    "Link": "va-is-influx-web-vis"
                },
                {
                    "Name": "input-va",
                    "Endtype": "client",
                    "Protocol": "TCP",
                    "DataType": "messages",
                    "Link": "vi-va-link",
                    "Port": "29170"
                }
            ]
        },
        {
            "Name": "WebVisualizer",
            "Description": "Web_visualizer module manifest",
            "SchemaVersion": "0.2",
            "ManifestFile": "${idx:webvisualizer:$EIS_VERSION}",
            "RunAsUser": "$EIS_UID",
            "RunAsGroup": "$EIS_UID",
            "Resources": {
                "CPU": 100,
                "MemoryMB": 100
            },
            "ExecutionEnv": {
                "AppName": "WebVisualizer",
                "PROFILING_MODE": "false",
                "ETCD_ENDPOINT": "${datastore.endpoint}",
                "CONFIGMGR_CACERT": "${databucket.cacert}",
                "CONFIGMGR_CERT": "${databucket.cert}",
                "CONFIGMGR_KEY": "${databucket.key}",
                "DEV_MODE": "$DEV_MODE",
                "ETCD_PREFIX": "$ETCD_PREFIX",
                "CertType": "zmq,pem",
                "ZMQ_RECV_HWM": "1000",
                "SubTopics": "VideoAnalytics/camera1_stream_results",
                "camera1_stream_results_cfg": "zmq_tcp,${ep.web-vis-in.remoteaddress}:${ep.web-vis-in.remoteport}"
            },
            "Endpoints": [
                {
                    "Name": "web-vis-out",
                    "Endtype": "server",
                    "Protocol": "TCP",
                    "Port": "5000",
                    "DataType": "messages",
                    "Link": "web-vis-outlink"
                },
                {
                    "Name": "web-vis-in",
                    "Endtype": "client",
                    "DataType": "messages",
                    "Link": "va-is-influx-web-vis",
                    "Port": "29170"
                }
            ]
        },
        {
            "Name": "InfluxDBConnector",
            "Description": "InfluxDBConnector module manifest",
            "SchemaVersion": "0.2",
            "ManifestFile": "${idx:influxdbconnector:$EIS_VERSION}",
            "RunAsUser": "$EIS_UID",
            "RunAsGroup": "$EIS_UID",
            "Resources": {
                "CPU": 100,
                "MemoryMB": 100
            },
            "ExecutionEnv": {
                "AppName": "InfluxDBConnector",
                "ETCD_ENDPOINT": "${datastore.endpoint}",
                "CONFIGMGR_CACERT": "${databucket.cacert}",
                "CONFIGMGR_CERT": "${databucket.cert}",
                "CONFIGMGR_KEY": "${databucket.key}",
                "ETCD_PREFIX": "$ETCD_PREFIX",
                "DEV_MODE": "$DEV_MODE",
                "PROFILING_MODE": "false",
                "ZMQ_RECV_HWM": "1000",
                "Clients": "Visualizer",
                "Server": "zmq_tcp,0.0.0.0:${ep.sOutInflux.localport}",
		"SubTopics": "VideoAnalytics/camera1_stream_results",
                "camera1_stream_results_cfg": "zmq_tcp,${ep.influx-va-in.remoteaddress}:${ep.influx-va-in.remoteport}"
            },
            "Endpoints": [
                {
                    "Name": "sOutInflux",
                    "Endtype": "server",
                    "Port": "8675",
		    "DataType": "messages",
                    "Link": "sinfluxout"
                },
                {
                    "Name": "influx-va-in",
                    "Endtype": "client",
                    "DataType": "messages",
                    "Link": "va-is-influx-web-vis"
                }
            ]
        },
        {
            "Name": "ImageStore",
            "Description": "ImageStore module manifest",
            "SchemaVersion": "0.2",
            "ManifestFile": "${idx:imagestore:$EIS_VERSION}",
            "RunAsUser": "$EIS_UID",
            "RunAsGroup": "$EIS_UID",
            "Resources": {
                "CPU": 100,
                "MemoryMB": 100
            },
            "ExecutionEnv": {
                "AppName": "ImageStore",
                "ETCD_ENDPOINT": "${datastore.endpoint}",
                "CONFIGMGR_CACERT": "${databucket.cacert}",
                "CONFIGMGR_CERT": "${databucket.cert}",
                "CONFIGMGR_KEY": "${databucket.key}",
                "ETCD_PREFIX": "$ETCD_PREFIX",
                "DEV_MODE": "$DEV_MODE",
                "PROFILING_MODE": "false",
                "ZMQ_RECV_HWM": "1000",
                "Clients": "Visualizer",
                "Server": "zmq_tcp,0.0.0.0:${ep.out-is-server.localport}",
		"SubTopics": "VideoAnalytics/camera1_stream_results",
                "camera1_stream_results_cfg": "zmq_tcp,${ep.is-va-in.remoteaddress}:${ep.is-va-in.remoteport}"
            },
            "Endpoints": [
                {
                    "Name": "out-is-server",
                    "Endtype": "server",
                    "Port": "5669",
		    "DataType": "messages",
                    "Link": "server-is"
                },
                {
                    "Name": "is-va-in",
                    "Endtype": "client",
                    "DataType": "messages",
                    "Link": "va-is-influx-web-vis"
                }
            ]
	}
    ],
    "Links": [
        {
            "Name": "vi-va-link"
        },
        {
            "Name": "web-vis-outlink"
        },
        {
            "Name": "va-is-influx-web-vis"
        },
        {
            "Name": "vi-sw-tr"
        },
	{
            "Name": "sinfluxout"
        },
        {
            "Name": "server-is"
        },
	{
            "Name": "etcduiout"
        }
    ],
    "Ingresses": [
        {
            "Name": "ext-webvisualizer",
            "Protocol": "TCP",
            "Options": {
                "Backend": "web-vis-outlink",
                "Port": "31505"
            }
        },
	{
            "Name": "ext-etcdui",
            "Protocol": "TCP",
            "Options": {
                "Backend": "etcduiout",
                "Port": "31508"
            }
	}
    ]
}
